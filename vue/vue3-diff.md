# ã€æºç ç³»åˆ—#06ã€‘Vue3 Diffç®—æ³•ðŸŒ¸
## å‰åŽå…ƒç´ ä¸ä¸€è‡´
- ä¸¤ä¸ªä¸åŒè™šæ‹ŸèŠ‚ç‚¹ä¸éœ€è¦è¿›è¡Œæ¯”è¾ƒï¼Œç›´æŽ¥ç§»é™¤è€çš„èŠ‚ç‚¹ï¼Œç„¶åŽå°†æ–°çš„èŠ‚ç‚¹æ¸²æŸ“æˆçœŸå®žçš„domæŒ‚è½½åˆ°é¡µé¢ä¸Š

## å‰åŽå…ƒç´ ä¸€è‡´
- ä¸¤ä¸ªç›¸åŒçš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œå…ˆå¤ç”¨èŠ‚ç‚¹ï¼Œå†æ¯”è¾ƒä¸¤ä¸ªèŠ‚ç‚¹çš„å±žæ€§å’Œå­èŠ‚ç‚¹
  - èƒ½å¤ç”¨å°±å¤ç”¨
  - ç„¶åŽå†æ–°å¢žæˆ–è€…åˆ é™¤
- åˆ¤æ–­æ˜¯å¦æ˜¯ç›¸åŒçš„è™šæ‹ŸèŠ‚ç‚¹ï¼Ÿ
  - åˆ¤æ–­èŠ‚ç‚¹çš„keyæ˜¯å¦ç›¸åŒ
  - åˆ¤æ–­èŠ‚ç‚¹çš„typeæ˜¯å¦ç›¸åŒ

## æ ¸å¿ƒDiffç®—æ³•
  å‰åºæ¯”å¯¹ã€åŽåºæ¯”å¯¹ã€åŒåºåˆ—åŠ æŒ‚è½½ã€åŒåºåˆ—åŠ å¸è½½çš„ç›®çš„éƒ½æ˜¯ï¼šå°½å¯èƒ½å‡å°‘åŽé¢ä¹±åºæ¯”å¯¹çš„å…ƒç´  åœ¨æ­£å¼ä»‹ç»diffç®—æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªé—®é¢˜

  å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯ç›¸åŒçš„è™šæ‹ŸèŠ‚ç‚¹ï¼Ÿ
  ç­”ï¼šè™šæ‹ŸèŠ‚ç‚¹çš„ typeç±»åž‹ç›¸åŒ && keyç›¸åŒ å³å¯

  c1ã€c2 æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ
  ç­”ï¼špatchå¯¹æ¯”å…ƒç´ æ‰“è¡¥ä¸ï¼Œå…ˆå¤ç”¨èŠ‚ç‚¹ã€å†æ¯”è¾ƒå±žæ€§ã€æœ€åŽæ¯”è¾ƒå„¿å­èŠ‚ç‚¹ã€‚c1æŒ‡çš„æ˜¯æ—§çš„å„¿å­èŠ‚ç‚¹ï¼›c2æŒ‡çš„æ˜¯æ–°çš„å„¿å­èŠ‚ç‚¹

  e1ã€e2 æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ
  ç­”ï¼šå°¾æŒ‡é’ˆï¼Œåˆå§‹å€¼åˆ†åˆ«æŒ‡å‘æ–°æ—§å­©å­çš„æœ€åŽä¸€ä¸ªèŠ‚ç‚¹ï¼Œe1 = c1.length - 1 ï¼›e2 = c2.length - 1

  - sync from start å‰åºå¯¹æ¯”
    ä»Žå¤´éƒ¨å¼€å§‹æ­£åºæ¯”å¯¹
    å¦‚æžœæ˜¯ç›¸åŒçš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨patchå¯¹æ¯”å…ƒç´ æ‰“è¡¥ä¸ï¼ˆå…ˆå¤ç”¨èŠ‚ç‚¹ã€å†æ¯”è¾ƒå±žæ€§ã€å†é€’å½’æ¯”è¾ƒå­èŠ‚ç‚¹ï¼‰ï¼Œi+1
    ç»ˆæ­¢æ¡ä»¶ï¼šæ–°æ—§è™šæ‹ŸèŠ‚ç‚¹ä¸ä¸€è‡´ï¼Œæˆ–ï¼Œ åŒæ–¹æœ‰ä¸€æ–¹ i å¤§äºŽ å°¾æŒ‡é’ˆï¼Œåœæ­¢å¾ªçŽ¯(i > e1 && i > e2)
    
  - sync from end åŽåºå¯¹æ¯”
  - common sequence+mount åŒåºåˆ—åŠ æŒ‚è½½
    åˆ†ä¸º å¤´éƒ¨æŒ‚è½½ å’Œ å°¾éƒ¨æŒ‚è½½ ä¸¤ç§åœºæ™¯
    i æ¯” e1 å¤§è¯´æ˜Žæœ‰è¦æ–°å¢žçš„ï¼Œi å’Œ e2 ä¹‹é—´çš„æ˜¯æ–°å¢žçš„èŠ‚ç‚¹
    ```
      // common sequence + mount åŒåºåˆ—åŠ æŒ‚è½½
      // iè¦æ¯”e1å¤§è¯´æ˜Žæœ‰æ–°å¢žçš„ï¼›iå’Œe2ä¹‹é—´çš„æ˜¯æ–°å¢žçš„éƒ¨åˆ†
      // (a b c)
      // (a b c) d e
      //     (a b c)
      // e d (a b c)
      if (i > e1) {
        if (i <= e2) {
          while (i <= e2) {
            const nextPos = e2 + 1
            // æ ¹æ®ä¸‹ä¸€ä¸ªäººçš„ç´¢å¼•æ¥çœ‹å‚ç…§ç‰©
            const anchor = nextPos < c2.length ? c2[nextPos].el : null
            patch(null, c2[i], container, anchor) // åˆ›å»ºæ–°èŠ‚ç‚¹ æ‰”åˆ°å®¹å™¨ä¸­
            i++
          }
        }
      }

    ```
  - common sequence+unmount åŒåºåˆ—åŠ å¸è½½
    åˆ†ä¸º å¤´éƒ¨å¸è½½ å’Œ å°¾éƒ¨å¸è½½ ä¸¤ç§åœºæ™¯
    i æ¯” e2 å¤§è¯´æ˜Žæœ‰è¦å¸è½½çš„ï¼Œi åˆ° e1 ä¹‹é—´çš„å°±æ˜¯è¦å¸è½½çš„èŠ‚ç‚¹
    ```
      // common sequence + unmount åŒåºåˆ—åŠ å¸è½½
      // iæ¯”e2å¤§è¯´æ˜Žæœ‰è¦å¸è½½çš„ï¼›iåˆ°e1ä¹‹é—´çš„å°±æ˜¯è¦å¸è½½çš„
      // (a b c) d e
      // (a b c)
      // e d (a b c)
      //     (a b c)
      else if (i > e2) {
        if (i <= e1) {
          while (i <= e1) {
            unmount(c1[i])
            i++
          }
        }
      }
    ```
  - unknown sequence ä¹±åºå¯¹æ¯”