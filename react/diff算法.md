### react diff 算法

- 基于 fiber 架构的 diff 算法
- 与 vue diff 算法区别：vue 是双指针策略，因为 diff 对象是两个数组；react diff 的对象是一个数组和一个 fiber 解构(react 不采用双指针的原因)
- 对比的对象是根据新的 jsx 数据类型 diff 出需要变动的旧的 fiber，并且变动的部分打上标记，生成新的 fiber 结构
- react 采用右移策略，对于需要变动的节点，始终都将其往最右侧移动。
  react diff 算法的过程

- 将 new 新节点数组的第一个节点拿到 old 旧的 fiber 链表里面的第一个节点比较，相同旧复用， 不同就跳出循环下一步
- 对旧节点生成一个节点与下标的 map 表, 新节点每一项对应旧节点的 map 表，并记录 lastIndex 为 0

```
eg:
{
  A : 0,
  B : 1,
  C : 2,
  D : 3
}
```

- 遍历 new 的每一个节点，当前节点的索引和 lastIndex 比较
- 如果大于则不动，并将当前的节点下标赋值给 lastIndex
- 如果小于，则将当前节点移动到最右侧

eg

```
  old [A , B , C , D]
  new [B , D , A , C]
  第一步：
    A 和 B 比较，不同，跳出循环
  第二步：生成map表；
  {
    A : 0,
    B : 1,
    C : 2,
    D : 3
  }
    old [A , B , C , D]
        0   1   2   3
    new [B , D , A , C]
        1   3   0   2

此时lastIndex = 0;以下简称l
遍历new
B(1) > l(0)  所以不移动； 并将 l 赋值为 1
D(3) > l(1)  所以不移动； 并将 l 赋值为 3
A(0) < l(3)  记录一下 将A移动到最右侧
C(2) < l(3)  记录一下 将C移动到最右侧
结束diff，生成的待操作表是 1 将A移动到最右侧 2 将C移动到最右侧
```
