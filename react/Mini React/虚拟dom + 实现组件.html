<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>虚拟dom + 实现组件</title>
  <style>
    #app-container {
      border: 2px solid #000;
      padding: 20px;
      margin: 20px;
    }

    .greeting {
      font-size: 20px;
      margin: 10px 0;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script>
    // 定义 createElement 和 createTextElement 函数
    function createElement(type, props, ...children) {

      return {
        type,
        props: props || {},
        children: children.map(child => typeof child === 'object' ? child : createTextElement(child)),
      };
    }

    function createTextElement(text) {
      return {
        type: 'TEXT_ELEMENT',
        props: { nodeValue: text },
        children: [],
      };
    }

    // 定义 render 函数，支持函数组件
    function render(vdom, container) {
      // 如果 vdom.type 是函数，调用它以获取子虚拟 DOM
      if (typeof vdom.type === 'function') {
        const component = vdom.type;
        const props = vdom.props;
        const childVdom = component(props);
        render(childVdom, container);
        return;
      }

      // 创建真实 DOM 节点
      const dom =
        vdom.type === 'TEXT_ELEMENT'
          ? document.createTextNode(vdom.props.nodeValue || '')
          : document.createElement(vdom.type);

      // 设置属性
      Object.keys(vdom.props).forEach(name => {
        if (name.startsWith('on')) {
          const eventType = name.slice(2).toLowerCase();
          dom.addEventListener(eventType, vdom.props[name]);
        } else if (name === 'style') {
          Object.assign(dom.style, vdom.props[name]);
        } else {
          dom[name] = vdom.props[name];
        }
      });

      // 递归渲染子节点
      vdom.children.forEach(child => render(child, dom));

      container.appendChild(dom);
    }

    // 定义一个简单的组件
    function Greeting(props) {
      return createElement('div', { className: 'greeting' }, `Hello, ${props.name}!`);
    }

    // 定义另一个组件，包含事件处理
    function App(props) {

      return createElement('div', { id: 'app-container' },
        createElement('h1', null, '欢迎使用 Mini React!'),
        createElement(Greeting, { name: 'Alice' }),
        createElement(Greeting, { name: 'Bob' }),
        createElement('button', { onClick: () => alert('按钮被点击了！') }, '点击我')
      );
    }
    // 渲染 App 组件到页面上
    const container = document.getElementById('root');
    const appVdom = createElement(App, {name: 123124123});
    render(appVdom, container);
  </script>
</body>

</html>